{
  "$schema": "https://json-schema.org/draft-07/schema",
  "version": "1.2.0",
  "title": "NextMonth Orbit Behaviour Contract",
  "description": "51-item contract defining expected Orbit system behaviours with evidence-based verification, including Ingestion v2, compliance, ICE Preview, and ICE Navigation checks",
  "lastUpdated": "2026-01-10",
  "categories": {
    "chat_core": "Core chat functionality",
    "view_engine": "View Engine structured responses",
    "tile_system": "Topic tile generation and display",
    "orbit_navigation": "Navigation and routing",
    "theme_system": "Theme and visual consistency",
    "data_persistence": "Data storage and caching",
    "security": "Access control and validation",
    "performance": "Response times and limits",
    "ingestion_v2": "Ingestion v2 discovery, sampling, throttling, caching",
    "compliance": "Robots.txt respect and friction handling",
    "ice_preview": "ICE Preview playback and styling",
    "ice_navigation": "ICE Maker navigation and routing"
  },
  "items": [
    {
      "id": "CHAT_001",
      "category": "chat_core",
      "title": "Chat bubble renders on public orbit page",
      "description": "Central chat bubble component appears on /orbit/:slug public pages",
      "severity": "critical",
      "evidenceType": "render_event",
      "evidenceKey": "nm_chat_bubble_rendered",
      "endpoint": null,
      "component": "OrbitChatBubble"
    },
    {
      "id": "CHAT_002",
      "category": "chat_core",
      "title": "Chat accepts user message input",
      "description": "User can type and submit messages to the Orbit chat",
      "severity": "critical",
      "evidenceType": "api_response",
      "evidenceKey": "nm_chat_message_sent",
      "endpoint": "POST /api/orbit/:slug/chat",
      "component": "OrbitChatInput"
    },
    {
      "id": "CHAT_003",
      "category": "chat_core",
      "title": "Chat returns AI response",
      "description": "AI generates contextual response based on Orbit knowledge",
      "severity": "critical",
      "evidenceType": "api_response",
      "evidenceKey": "nm_chat_response_received",
      "endpoint": "POST /api/orbit/:slug/chat",
      "component": null
    },
    {
      "id": "CHAT_004",
      "category": "chat_core",
      "title": "Business-type-aware prompting",
      "description": "Chat system prompt adapts based on Orbit business type",
      "severity": "high",
      "evidenceType": "api_metadata",
      "evidenceKey": "nm_business_type_detected",
      "endpoint": "POST /api/orbit/:slug/chat",
      "component": null
    },
    {
      "id": "CHAT_005",
      "category": "chat_core",
      "title": "Echo mode for testimonial capture",
      "description": "Positive sentiment triggers echo response for testimonial collection",
      "severity": "medium",
      "evidenceType": "api_metadata",
      "evidenceKey": "nm_echo_triggered",
      "endpoint": "POST /api/orbit/:slug/chat",
      "component": null
    },
    {
      "id": "VIEW_001",
      "category": "view_engine",
      "title": "Compare view renders structured comparison",
      "description": "View Engine renders compare template with product/service comparison",
      "severity": "high",
      "evidenceType": "render_event",
      "evidenceKey": "nm_view_compare_rendered",
      "endpoint": null,
      "component": "ViewCompare"
    },
    {
      "id": "VIEW_002",
      "category": "view_engine",
      "title": "Shortlist view renders item collection",
      "description": "View Engine renders shortlist template with filtered items",
      "severity": "high",
      "evidenceType": "render_event",
      "evidenceKey": "nm_view_shortlist_rendered",
      "endpoint": null,
      "component": "ViewShortlist"
    },
    {
      "id": "VIEW_003",
      "category": "view_engine",
      "title": "Checklist view renders actionable items",
      "description": "View Engine renders checklist template with checkable items",
      "severity": "high",
      "evidenceType": "render_event",
      "evidenceKey": "nm_view_checklist_rendered",
      "endpoint": null,
      "component": "ViewChecklist"
    },
    {
      "id": "VIEW_004",
      "category": "view_engine",
      "title": "Pulse view renders trend/insight data",
      "description": "View Engine renders pulse template with trend information",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_view_pulse_rendered",
      "endpoint": null,
      "component": "ViewPulse"
    },
    {
      "id": "VIEW_005",
      "category": "view_engine",
      "title": "Turn into ICE button for privileged users",
      "description": "Admin/influencer users see 'Turn into ICE' button on View Engine outputs",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_ice_draft_button_rendered",
      "endpoint": null,
      "component": "IceDraftButton"
    },
    {
      "id": "TILE_001",
      "category": "tile_system",
      "title": "Website ingestion generates minimum 12 tiles",
      "description": "URL ingestion produces at least 12 topic tiles per Orbit",
      "severity": "high",
      "evidenceType": "api_response",
      "evidenceKey": "nm_tile_count",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "minValue": 12
      }
    },
    {
      "id": "TILE_002",
      "category": "tile_system",
      "title": "Tiles display with confidence levels",
      "description": "Each tile shows confidence indicator (high/medium/low)",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_tile_confidence_rendered",
      "endpoint": null,
      "component": "TileCard"
    },
    {
      "id": "TILE_003",
      "category": "tile_system",
      "title": "Tiles categorized into groups",
      "description": "Tiles organized by category (Insights, Services, FAQs, Proof, Recommendations)",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_tile_categories_rendered",
      "endpoint": null,
      "component": "TileGrid"
    },
    {
      "id": "TILE_004",
      "category": "tile_system",
      "title": "Tile drawer shows detailed content",
      "description": "Clicking tile opens drawer with full content and sources",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_tile_drawer_opened",
      "endpoint": null,
      "component": "TileDrawer"
    },
    {
      "id": "TILE_005",
      "category": "tile_system",
      "title": "Tiles scoped to specific Orbit",
      "description": "Each Orbit has isolated tile storage, no cross-contamination",
      "severity": "critical",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_tile_isolation",
      "endpoint": "GET /api/orbit/:slug/tiles",
      "component": null
    },
    {
      "id": "TILE_006",
      "category": "tile_system",
      "title": "Business context tiles include summaries",
      "description": "About, FAQ, Contact, and other context tiles have pre-populated content summaries rather than just links",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_tile_summaries",
      "endpoint": "GET /api/orbit/:slug/tiles",
      "component": null,
      "validation": {
        "requiredTypes": ["about", "faq", "contact", "business_profile"],
        "minSummaryLength": 50
      }
    },
    {
      "id": "NAV_001",
      "category": "orbit_navigation",
      "title": "Public Orbit page loads at /orbit/:slug",
      "description": "Public-facing Orbit pages accessible without authentication",
      "severity": "critical",
      "evidenceType": "route_exists",
      "evidenceKey": "nm_route_orbit_public",
      "endpoint": "/orbit/:slug",
      "component": "OrbitPublicPage"
    },
    {
      "id": "NAV_002",
      "category": "orbit_navigation",
      "title": "Import page at /orbit/:slug/import",
      "description": "Catalogue import accessible for Orbit owners",
      "severity": "high",
      "evidenceType": "route_exists",
      "evidenceKey": "nm_route_orbit_import",
      "endpoint": "/orbit/:slug/import",
      "component": "CatalogueImport"
    },
    {
      "id": "NAV_003",
      "category": "orbit_navigation",
      "title": "Settings page at /orbit/:slug/settings",
      "description": "Orbit settings accessible for owners",
      "severity": "high",
      "evidenceType": "route_exists",
      "evidenceKey": "nm_route_orbit_settings",
      "endpoint": "/orbit/:slug/settings",
      "component": "OrbitSettings"
    },
    {
      "id": "NAV_004",
      "category": "orbit_navigation",
      "title": "DataHub page at /orbit/:slug/datahub",
      "description": "DataHub accessible for Orbit data management",
      "severity": "high",
      "evidenceType": "route_exists",
      "evidenceKey": "nm_route_orbit_datahub",
      "endpoint": "/orbit/:slug/datahub",
      "component": "OrbitDataHub"
    },
    {
      "id": "NAV_005",
      "category": "orbit_navigation",
      "title": "Launchpad accessible at /launchpad",
      "description": "Launchpad hub renders Orbit metrics and IceMaker access",
      "severity": "high",
      "evidenceType": "route_exists",
      "evidenceKey": "nm_route_launchpad",
      "endpoint": "/launchpad",
      "component": "Launchpad"
    },
    {
      "id": "THEME_001",
      "category": "theme_system",
      "title": "Global theme toggle works",
      "description": "App-wide light/dark mode switching persists across sessions",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_theme_toggle_rendered",
      "endpoint": null,
      "component": "ThemeToggle"
    },
    {
      "id": "THEME_002",
      "category": "theme_system",
      "title": "Orbit pages use calm neutral baseline",
      "description": "Public Orbit pages follow 90/9/1 color rule with monochrome surfaces",
      "severity": "medium",
      "evidenceType": "visual_audit",
      "evidenceKey": "nm_theme_baseline",
      "endpoint": null,
      "component": null
    },
    {
      "id": "THEME_003",
      "category": "theme_system",
      "title": "Orbit isolated theme controls",
      "description": "Public Orbit pages have independent theme from app pages",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_orbit_theme_isolated",
      "endpoint": null,
      "component": "OrbitThemeProvider"
    },
    {
      "id": "DATA_001",
      "category": "data_persistence",
      "title": "Tiles cached for 24 hours",
      "description": "Ingestion results cached per Orbit with 24hr freshness window",
      "severity": "medium",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_cache_check",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null
    },
    {
      "id": "DATA_002",
      "category": "data_persistence",
      "title": "Orbit settings persist",
      "description": "Orbit settings saved to database and retrieved correctly",
      "severity": "high",
      "evidenceType": "api_response",
      "evidenceKey": "nm_settings_saved",
      "endpoint": "PUT /api/orbit/:slug/settings",
      "component": null
    },
    {
      "id": "DATA_003",
      "category": "data_persistence",
      "title": "Chat history preserved",
      "description": "Conversation history maintained within session",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_chat_history_rendered",
      "endpoint": null,
      "component": "ChatHistory"
    },
    {
      "id": "SEC_001",
      "category": "security",
      "title": "Orbit existence validated",
      "description": "API endpoints verify Orbit exists before processing",
      "severity": "critical",
      "evidenceType": "api_response",
      "evidenceKey": "nm_orbit_validated",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null
    },
    {
      "id": "SEC_002",
      "category": "security",
      "title": "Rate limiting applied",
      "description": "API endpoints enforce rate limits per IP",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_rate_limit_check",
      "endpoint": null,
      "component": null
    },
    {
      "id": "PERF_001",
      "category": "performance",
      "title": "Chat response under 5 seconds",
      "description": "AI chat responses return within acceptable latency",
      "severity": "medium",
      "evidenceType": "api_response",
      "evidenceKey": "nm_response_time_ms",
      "endpoint": "POST /api/orbit/:slug/chat",
      "component": null,
      "validation": {
        "maxValue": 5000
      }
    },
    {
      "id": "PERF_002",
      "category": "performance",
      "title": "Tile ingestion under 30 seconds",
      "description": "Website crawl and tile generation completes within limit",
      "severity": "medium",
      "evidenceType": "api_response",
      "evidenceKey": "nm_ingestion_time_ms",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "maxValue": 30000
      }
    },
    {
      "id": "INGEST_001",
      "category": "ingestion_v2",
      "title": "Light mode uses discovery-first strategy",
      "description": "Light mode attempts discovery sources (homepage, robots, sitemap) before sampling, fetches <=12 pages",
      "severity": "high",
      "evidenceType": "playback",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": "IngestionSummary",
      "validation": {
        "mode": "light",
        "requiredSources": ["homepage", "robots"],
        "maxPagesFetched": 12
      }
    },
    {
      "id": "INGEST_002",
      "category": "ingestion_v2",
      "title": "Sitemap is preferred when available",
      "description": "When sitemap returns 200, it is used as canonical URL source for sampling",
      "severity": "high",
      "evidenceType": "playback",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "sitemapCheck": "if_available_must_use"
      }
    },
    {
      "id": "INGEST_003",
      "category": "ingestion_v2",
      "title": "Adaptive throttling increases delay after friction",
      "description": "When friction signals (403/429/503) detected, recommendedDelayMs increases and ingestion stops early",
      "severity": "high",
      "evidenceType": "playback",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "frictionMustIncreaseDelay": true
      }
    },
    {
      "id": "INGEST_004",
      "category": "ingestion_v2",
      "title": "Bot protection yields first-class blocked outcome",
      "description": "When bot protection detected, outcome is 'blocked', not fake success. No confirmed tiles without sources.",
      "severity": "critical",
      "evidenceType": "playback",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": "BlockedTile",
      "validation": {
        "outcomeOnBlock": "blocked",
        "noFakeSuccess": true
      }
    },
    {
      "id": "INGEST_005",
      "category": "ingestion_v2",
      "title": "URL-level caching reduces repeated fetches",
      "description": "Repeated runs within cache window show cache hits, reducing total requests",
      "severity": "medium",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "cacheHitsOnRepeat": true,
        "maxRefetchesPerUrl24h": 3
      }
    },
    {
      "id": "INGEST_006",
      "category": "ingestion_v2",
      "title": "User-assisted mode only fetches user-provided URLs",
      "description": "In user_assisted mode, only the URLs provided by user are fetched, no extra crawling",
      "severity": "medium",
      "evidenceType": "playback",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "mode": "user_assisted",
        "urlSource": "user_list"
      }
    },
    {
      "id": "INGEST_007",
      "category": "ingestion_v2",
      "title": "Domain risk score persisted per host",
      "description": "Domain risk record exists after ingestion with lastAttemptAt and frictionCount fields",
      "severity": "medium",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_domain_risk",
      "endpoint": null,
      "component": null,
      "validation": {
        "fieldsRequired": ["lastAttemptAt", "frictionCount", "recommendedDelayMs"]
      }
    },
    {
      "id": "COMPLY_001",
      "category": "compliance",
      "title": "Robots.txt respected for disallowed paths",
      "description": "URLs disallowed in robots.txt are not fetched during ingestion",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "robotsRespected": true
      }
    },
    {
      "id": "COMPLY_002",
      "category": "compliance",
      "title": "Ingestion stops on friction (no aggressive retries)",
      "description": "When 403/429/challenge detected, system halts further requests. Retry count per URL capped at 1.",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_ingest",
      "endpoint": "POST /api/orbit/:slug/ingest-url",
      "component": null,
      "validation": {
        "haltOnFriction": true,
        "maxRetriesPerUrl": 1
      }
    },
    {
      "id": "ICEPREV_001",
      "category": "ice_preview",
      "title": "ICE Preview loads for valid id",
      "description": "ICE Preview page at /ice/preview/:id renders successfully for valid ICE IDs",
      "severity": "critical",
      "evidenceType": "route_exists",
      "evidenceKey": "nm_ice_preview_loaded",
      "endpoint": "GET /ice/preview/:id",
      "component": "GuestIceBuilderPage"
    },
    {
      "id": "ICEPREV_002",
      "category": "ice_preview",
      "title": "Title Pack selector renders",
      "description": "TitlePackSelector component renders with all 5 title pack options",
      "severity": "high",
      "evidenceType": "render_event",
      "evidenceKey": "nm_title_pack_selector",
      "endpoint": null,
      "component": "TitlePackSelector"
    },
    {
      "id": "ICEPREV_003",
      "category": "ice_preview",
      "title": "Selecting a pack updates renderables and persists",
      "description": "Changing title pack updates preview instantly and saves to ICE record",
      "severity": "high",
      "evidenceType": "api_response",
      "evidenceKey": "nm_title_pack_saved",
      "endpoint": "PUT /api/ice/preview/:id/settings",
      "component": null
    },
    {
      "id": "ICEPREV_004",
      "category": "ice_preview",
      "title": "Preview render uses same token system as builder",
      "description": "CardPlayer uses same titlePack tokens for consistent styling between builder and preview",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_token_consistency",
      "endpoint": null,
      "component": "CardPlayer"
    },
    {
      "id": "ICEPREV_005",
      "category": "ice_preview",
      "title": "No fallback styling used",
      "description": "Preview never falls back to default styling when titlePackId is set",
      "severity": "medium",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_no_fallback",
      "endpoint": null,
      "component": "CardPlayer"
    },
    {
      "id": "ICENAV_001",
      "category": "ice_navigation",
      "title": "Nav shows only functional links",
      "description": "IceMaker navigation only displays links to working features",
      "severity": "high",
      "evidenceType": "render_event",
      "evidenceKey": "nm_nav_functional",
      "endpoint": null,
      "component": "IceMakerLayout"
    },
    {
      "id": "ICENAV_002",
      "category": "ice_navigation",
      "title": "Projects page hidden or shows real list",
      "description": "Projects page is either hidden from nav or displays actual user projects",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_projects_functional",
      "endpoint": null,
      "component": "IceMakerProjects"
    },
    {
      "id": "ICENAV_003",
      "category": "ice_navigation",
      "title": "Templates create prefilled ICE or are hidden",
      "description": "Templates either instantiate actual prefilled ICE or are hidden from navigation",
      "severity": "high",
      "evidenceType": "deterministic",
      "evidenceKey": "nm_templates_functional",
      "endpoint": null,
      "component": "IceMakerTemplates"
    },
    {
      "id": "PREVIEW_001",
      "category": "orbit_navigation",
      "title": "Orbit Preview clearly labelled as Orbit",
      "description": "The /preview/:id page is explicitly labelled as Orbit Preview in UI to avoid confusion with ICE Preview",
      "severity": "medium",
      "evidenceType": "render_event",
      "evidenceKey": "nm_orbit_preview_label",
      "endpoint": null,
      "component": "PreviewPage"
    }
  ],
  "severityLevels": {
    "critical": {
      "description": "System unusable if failing",
      "slaHours": 1,
      "color": "red"
    },
    "high": {
      "description": "Major feature degradation",
      "slaHours": 4,
      "color": "orange"
    },
    "medium": {
      "description": "Feature works but impaired",
      "slaHours": 24,
      "color": "yellow"
    },
    "low": {
      "description": "Minor inconvenience",
      "slaHours": 72,
      "color": "gray"
    }
  },
  "evidenceTypes": {
    "render_event": "Client-side component render confirmation via nm_render_event",
    "api_response": "Server response includes nm_* metadata with evidence",
    "api_metadata": "Server response metadata contains specific field",
    "deterministic": "Automated check verifies behaviour programmatically",
    "route_exists": "Route registered in router and accessible",
    "visual_audit": "Manual/automated visual verification required",
    "playback": "End-to-end verification via Playwright or controlled test requiring both server nm_ingest and client render events"
  }
}
